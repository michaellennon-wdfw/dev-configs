# --- simple, colored prompt with venv, git, SSH user@host when applicable ---
# Helpers
prompt_venv() {
  [[ -n "$VIRTUAL_ENV" ]]       && echo "($(basename "$VIRTUAL_ENV"))"
}
prompt_git() {
  command -v git >/dev/null || return
  git rev-parse --is-inside-work-tree >/dev/null 2>&1 || return
  local b dirty
  b=$(git symbolic-ref --quiet --short HEAD 2>/dev/null \
      || git describe --tags --exact-match 2>/dev/null \
      || git rev-parse --short HEAD 2>/dev/null) || return
  git diff --quiet --ignore-submodules --cached || dirty="*"
  git diff --quiet --ignore-submodules || dirty="*"
  echo "$b${dirty}"
}

# Show user@host only over SSH
SSH_PART=''
[[ -n "$SSH_CONNECTION" || -n "$SSH_TTY" ]] && SSH_PART='%n@%m'

# Left prompt: [SSH user@host] path git venv then green caret
autoload -Uz add-zsh-hook

build_prompt() {
	local -a segs
	segs+=('%F{244}%*%f')
	[[ -n $SSH_PART ]] && segs+=("$SSH_PART")
	segs+=('%F{blue}%1~%f')

	local git venv
	git="$(prompt_git)"; [[ -n $git ]] && segs+=("%F{cyan}${git}%f")
	venv="$(prompt_venv)"; [[ -n $venv ]] && segs+=("%F{magenta}${venv}%f")

	# Always show green caret regardless of last status
	PROMPT="${(j: :)segs} %F{green}‚ùØ%f "
}

add-zsh-hook precmd build_prompt
# --- end ---
